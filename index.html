<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MentorComm | Sistema de Comiss√µes</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            /* Paleta de cores moderna */
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --secondary: #10b981;
            --accent: #f59e0b;
            --danger: #ef4444;
            --warning: #fbbf24;
            
            /* Tons de cinza sofisticados */
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --bg-card: #1e293b;
            --bg-input: #334155;
            
            /* Texto e bordas */
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --border-light: #475569;
            --border-medium: #334155;
            --border-dark: #1e293b;
            
            /* Efeitos */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.5), 0 10px 10px -5px rgba(0, 0, 0, 0.4);
            
            /* Transi√ß√µes */
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-normal: 250ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 350ms cubic-bezier(0.4, 0, 0.2, 1);
            
            /* Bordas */
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 14px;
            --radius-xl: 20px;
            --radius-full: 9999px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            padding: 16px;
            background-image: 
                radial-gradient(circle at 15% 50%, rgba(99, 102, 241, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 85% 30%, rgba(16, 185, 129, 0.05) 0%, transparent 20%);
        }

        /* Layout Principal */
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* Header Estilizado - Responsivo */
        .app-header {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            border-radius: var(--radius-xl);
            padding: 24px;
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }

        .app-header::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 150px;
            height: 150px;
            background: linear-gradient(45deg, var(--primary) 0%, transparent 70%);
            opacity: 0.1;
            border-radius: 0 0 0 100px;
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .app-title {
            font-size: clamp(24px, 5vw, 32px);
            font-weight: 700;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--primary-light) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .app-subtitle {
            font-size: clamp(14px, 3vw, 16px);
            color: var(--text-secondary);
            font-weight: 400;
            margin-bottom: 20px;
        }

        /* Cards Modernos */
        .card {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-medium);
            padding: clamp(20px, 4vw, 32px);
            box-shadow: var(--shadow-md);
            transition: all var(--transition-normal);
            position: relative;
        }

        .card:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-lg);
            transform: translateY(-2px);
        }

        .card-header {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-medium);
        }

        @media (min-width: 768px) {
            .card-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
        }

        .card-title {
            font-size: clamp(18px, 4vw, 20px);
            font-weight: 600;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .card-title i {
            color: var(--primary);
            font-size: clamp(18px, 4vw, 20px);
        }

        /* Grids Responsivos */
        .grid-1 {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .grid-4 {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        @media (min-width: 640px) {
            .grid-2 {
                grid-template-columns: repeat(2, 1fr);
            }
            .grid-3 {
                grid-template-columns: repeat(2, 1fr);
            }
            .grid-4 {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (min-width: 1024px) {
            .grid-3 {
                grid-template-columns: repeat(3, 1fr);
            }
            .grid-4 {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* Formul√°rios Modernos - Mobile First */
        .form-group {
            margin-bottom: 16px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 14px;
            background: var(--bg-input);
            border: 1.5px solid var(--border-medium);
            border-radius: var(--radius-md);
            color: var(--text-primary);
            font-size: 16px; /* Tamanho maior para mobile */
            font-family: 'Inter', sans-serif;
            transition: all var(--transition-fast);
            -webkit-appearance: none; /* Remove estilo padr√£o iOS */
            appearance: none;
        }

        /* Aumenta √°rea de toque para mobile */
        .form-input,
        .form-select {
            min-height: 48px;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .form-input::placeholder {
            color: var(--text-muted);
        }

        /* Bot√µes Modernos - Mobile Friendly */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px 20px;
            border-radius: var(--radius-md);
            font-size: 16px;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
            cursor: pointer;
            transition: all var(--transition-fast);
            border: none;
            outline: none;
            position: relative;
            overflow: hidden;
            text-align: center;
            min-height: 48px; /* Altura m√≠nima para toque */
            width: 100%; /* Bot√µes ocupam toda largura no mobile */
        }

        @media (min-width: 640px) {
            .btn {
                width: auto;
                padding: 14px 28px;
            }
        }

        /* Efeito de clique para mobile */
        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--secondary) 0%, #0da271 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #f59e0b 100%);
            color: var(--bg-primary);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #dc2626 100%);
            color: white;
        }

        .btn-outline {
            background: transparent;
            border: 1.5px solid var(--border-light);
            color: var(--text-secondary);
        }

        .btn-outline:hover {
            border-color: var(--primary);
            color: var(--primary);
            background: rgba(99, 102, 241, 0.05);
        }

        .btn-sm {
            padding: 10px 16px;
            font-size: 14px;
            min-height: 40px;
        }

        .btn-icon {
            width: 48px;
            height: 48px;
            padding: 0;
            border-radius: var(--radius-full);
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        /* Container de bot√µes para mobile */
        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
            width: 100%;
        }

        @media (min-width: 640px) {
            .btn-group {
                flex-direction: row;
                flex-wrap: wrap;
            }
        }

        /* Tabela Moderna - Responsiva */
        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch; /* Scroll suave no iOS */
            margin: 20px 0;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-medium);
        }

        .data-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            min-width: 600px; /* Largura m√≠nima para manter legibilidade */
        }

        .data-table thead {
            background: linear-gradient(135deg, var(--bg-tertiary) 0%, var(--bg-secondary) 100%);
        }

        .data-table th {
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid var(--border-medium);
            white-space: nowrap;
        }

        .data-table td {
            padding: 16px;
            border-bottom: 1px solid var(--border-medium);
            background: var(--bg-card);
            vertical-align: middle;
        }

        .data-table tbody tr {
            transition: all var(--transition-fast);
        }

        .data-table tbody tr:hover {
            background: rgba(99, 102, 241, 0.05);
        }

        .data-table tbody tr:last-child td {
            border-bottom: none;
        }

        /* Inputs dentro da tabela - Mobile */
        .data-table input {
            padding: 10px;
            font-size: 14px;
            min-height: 40px;
        }

        /* Badges e Status */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: var(--radius-full);
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .badge-success {
            background: rgba(16, 185, 129, 0.15);
            color: var(--secondary);
        }

        .badge-warning {
            background: rgba(245, 158, 11, 0.15);
            color: var(--accent);
        }

        .badge-primary {
            background: rgba(99, 102, 241, 0.15);
            color: var(--primary-light);
        }

        .badge-danger {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }

        /* Estat√≠sticas e Cards de Valor */
        .stats-card {
            background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%);
            border-radius: var(--radius-lg);
            padding: 20px;
            border: 1px solid var(--border-medium);
            text-align: center;
        }

        .stats-value {
            font-size: clamp(24px, 6vw, 32px);
            font-weight: 700;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--primary) 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            line-height: 1;
            margin: 12px 0;
            word-break: break-word;
        }

        .stats-label {
            font-size: 13px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            display: block;
        }

        /* Modal Moderno - Responsivo */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(8px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-normal);
            padding: 20px;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-container {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-xl);
            transform: translateY(20px);
            transition: transform var(--transition-normal);
        }

        .modal-overlay.active .modal-container {
            transform: translateY(0);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-medium);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: var(--bg-card);
            z-index: 10;
        }

        .modal-title {
            font-size: clamp(18px, 4vw, 24px);
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 28px;
            cursor: pointer;
            transition: color var(--transition-fast);
            width: 48px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-full);
            flex-shrink: 0;
        }

        .modal-close:active {
            background: rgba(255, 255, 255, 0.05);
        }

        .modal-body {
            padding: 20px;
        }

        /* Filtro por Per√≠odo */
        .period-filter {
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            padding: 20px;
            margin-bottom: 20px;
        }

        .period-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
        }

        @media (min-width: 768px) {
            .period-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .period-result {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: var(--radius-md);
            padding: 20px;
            color: white;
            text-align: center;
            margin-top: 20px;
        }

        /* Lista de Colaboradores com A√ß√µes */
        .colaborador-item {
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 16px;
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            margin-bottom: 12px;
            border: 1px solid transparent;
            transition: all var(--transition-fast);
        }

        @media (min-width: 640px) {
            .colaborador-item {
                flex-direction: row;
                align-items: center;
                justify-content: space-between;
            }
        }

        .colaborador-item:hover {
            border-color: var(--primary);
        }

        .colaborador-info {
            flex: 1;
        }

        .colaborador-nome {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .colaborador-details {
            display: flex;
            gap: 16px;
            font-size: 14px;
            color: var(--text-secondary);
            flex-wrap: wrap;
        }

        .colaborador-actions {
            display: flex;
            gap: 8px;
        }

        /* Lista de Cargos */
        .cargo-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            margin-bottom: 8px;
            border: 1px solid transparent;
            transition: all var(--transition-fast);
        }

        .cargo-item:hover {
            border-color: var(--primary);
        }

        /* Menu Mobile */
        .mobile-menu {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 8px;
            -webkit-overflow-scrolling: touch;
        }

        .mobile-menu::-webkit-scrollbar {
            display: none;
        }

        .mobile-menu-btn {
            white-space: nowrap;
            flex-shrink: 0;
        }

        /* Scrollbar Personalizada */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
            border-radius: var(--radius-full);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-light);
            border-radius: var(--radius-full);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary);
        }

        /* Utilit√°rios */
        .flex {
            display: flex;
        }

        .flex-col {
            flex-direction: column;
        }

        .flex-between {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        @media (min-width: 768px) {
            .flex-between {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
        }

        .flex-center {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .gap-2 { gap: 8px; }
        .gap-4 { gap: 16px; }
        .gap-6 { gap: 24px; }
        .gap-8 { gap: 32px; }

        .mb-2 { margin-bottom: 8px; }
        .mb-4 { margin-bottom: 16px; }
        .mb-6 { margin-bottom: 24px; }
        .mb-8 { margin-bottom: 32px; }

        .mt-2 { margin-top: 8px; }
        .mt-4 { margin-top: 16px; }
        .mt-6 { margin-top: 24px; }
        .mt-8 { margin-top: 32px; }

        .p-2 { padding: 8px; }
        .p-4 { padding: 16px; }
        .p-6 { padding: 24px; }

        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .text-left { text-align: left; }

        .w-full { width: 100%; }
        .w-auto { width: auto; }

        .hidden { display: none; }
        .block { display: block; }

        @media (min-width: 768px) {
            .hidden-md { display: none; }
            .block-md { display: block; }
        }

        /* Anima√ß√µes */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .animate-fadeIn {
            animation: fadeIn var(--transition-normal) ease-out;
        }

        .animate-slideIn {
            animation: slideIn var(--transition-normal) ease-out;
        }

        /* Loading States */
        .loading {
            position: relative;
            overflow: hidden;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.05),
                transparent
            );
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Avisos e Alertas */
        .alert {
            padding: 16px;
            border-radius: var(--radius-md);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .alert-success {
            background: rgba(16, 185, 129, 0.15);
            border: 1px solid rgba(16, 185, 129, 0.3);
            color: var(--secondary);
        }

        .alert-danger {
            background: rgba(239, 68, 68, 0.15);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: var(--danger);
        }

        /* √çcones ajustados para mobile */
        .icon-lg {
            font-size: 24px;
        }

        .icon-md {
            font-size: 20px;
        }

        .icon-sm {
            font-size: 16px;
        }

        /* Ajustes espec√≠ficos para telas muito pequenas */
        @media (max-width: 360px) {
            html {
                font-size: 14px;
            }
            
            .btn {
                padding: 12px 16px;
                font-size: 14px;
            }
            
            .card {
                padding: 16px;
            }
            
            .stats-value {
                font-size: 20px;
            }
        }

        /* Ajuste para orienta√ß√£o paisagem em mobile */
        @media (max-height: 500px) and (orientation: landscape) {
            .modal-container {
                max-height: 80vh;
            }
            
            .app-header {
                padding: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Menu Mobile -->
        <div class="mobile-menu hidden-md">
            <button class="btn btn-sm btn-outline mobile-menu-btn" onclick="scrollToSection('gestao')">
                <i class="fas fa-users"></i> Colaboradores
            </button>
            <button class="btn btn-sm btn-outline mobile-menu-btn" onclick="scrollToSection('servicos')">
                <i class="fas fa-tasks"></i> Servi√ßos
            </button>
            <button class="btn btn-sm btn-outline mobile-menu-btn" onclick="scrollToSection('filtros')">
                <i class="fas fa-filter"></i> Filtros
            </button>
            <button class="btn btn-sm btn-outline mobile-menu-btn" onclick="scrollToSection('relatorios')">
                <i class="fas fa-chart-bar"></i> Relat√≥rios
            </button>
        </div>

        <!-- Header -->
        <header class="app-header animate-fadeIn">
            <div class="header-content">
                <h1 class="app-title">
                    <i class="fas fa-chart-line"></i> 
                    <span>MentorComm Pro</span>
                </h1>
                <p class="app-subtitle">Sistema Avan√ßado de Gest√£o de Comiss√µes ‚Ä¢ Taxa: 8%</p>
                
                <div class="flex-between mt-6">
                    <div class="stats-card">
                        <span class="stats-label">Comiss√£o Total</span>
                        <div class="stats-value" id="total-comissao">R$ 0,00</div>
                    </div>
                    
                    <div class="flex-center gap-2 mt-4 md:mt-0">
                        <button class="btn btn-sm btn-outline" onclick="abrirModalCargos()">
                            <i class="fas fa-user-tag"></i>
                            <span class="hidden md:inline">Cargos</span>
                        </button>
                        <button class="btn btn-sm btn-outline" onclick="abrirModalHistorico()">
                            <i class="fas fa-history"></i>
                            <span class="hidden md:inline">Hist√≥rico</span>
                        </button>
                        <button class="btn btn-sm btn-outline" onclick="abrirModalGerenciarColaboradores()">
                            <i class="fas fa-users-cog"></i>
                            <span class="hidden md:inline">Gerenciar</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Se√ß√£o: Gest√£o de Colaboradores -->
        <div class="card animate-slideIn" id="gestao">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-users"></i> Gest√£o de Colaboradores
                </h2>
                <span class="badge badge-primary" id="total-colabs">0 ativos</span>
            </div>
            
            <div class="form-group">
                <label class="form-label">Adicionar Novo Colaborador</label>
                <div class="grid-2 gap-4 mb-4">
                    <input type="text" id="novo-nome" class="form-input" placeholder="Nome completo" 
                           autocomplete="off" autocapitalize="words">
                    <input type="date" id="data-adicao" class="form-input">
                </div>
                <div class="flex-between gap-4 mb-4">
                    <select id="novo-cargo" class="form-select w-full md:w-auto">
                        <option value="">Selecione um cargo</option>
                    </select>
                    <button class="btn btn-primary w-full md:w-auto" onclick="adicionarNovoColaborador()">
                        <i class="fas fa-plus"></i> Adicionar
                    </button>
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">Colaborador Ativo</label>
                <select id="colaborador-selector" class="form-select" onchange="selecionarColaborador(this.value)">
                    <option value="">Selecione um colaborador</option>
                </select>
            </div>
            
            <div id="adicionar-msg" class="mt-4"></div>
        </div>

        <!-- Se√ß√£o: Detalhes do Colaborador -->
        <div class="grid-2 gap-4">
            <div class="card animate-slideIn">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-user-circle"></i> Detalhes do Colaborador
                    </h2>
                </div>
                
                <div class="text-center p-6">
                    <h3 id="colaborador-nome-display" class="mb-2" style="font-size: 22px; font-weight: 600;">-</h3>
                    <p id="colaborador-cargo-display" class="text-muted mb-4">-</p>
                    <p id="data-adicao-display" class="text-sm text-muted">-</p>
                </div>
                
                <div class="grid-2 gap-4">
                    <div class="stats-card">
                        <span class="stats-label">Total Hist√≥rico</span>
                        <div class="stats-value" id="ganho-total-historico">R$ 0,00</div>
                    </div>
                    <div class="stats-card">
                        <span class="stats-label">M√©dia Mensal</span>
                        <div class="stats-value" id="media-mensal-historico">R$ 0,00</div>
                    </div>
                </div>
            </div>

            <!-- Se√ß√£o: Servi√ßos -->
            <div class="card animate-slideIn" id="servicos">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-tasks"></i> Servi√ßos Prestados
                    </h2>
                    <button class="btn btn-sm btn-primary" onclick="adicionarServico()">
                        <i class="fas fa-plus"></i> Novo
                    </button>
                </div>
                
                <div id="servicos-container" class="mb-6">
                    <p class="text-center text-muted p-6">Selecione um colaborador para gerenciar servi√ßos</p>
                </div>
                
                <div class="grid-2 gap-4">
                    <div class="text-center">
                        <span class="stats-label">Faturamento</span>
                        <div class="stats-value" id="faturamento-individual">R$ 0,00</div>
                    </div>
                    <div class="text-center">
                        <span class="stats-label">Comiss√£o (8%)</span>
                        <div class="stats-value text-success" id="comissao-individual">R$ 0,00</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Se√ß√£o: Filtros por Per√≠odo -->
        <div class="card animate-fadeIn" id="filtros">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-calendar-alt"></i> Filtro por Per√≠odo
                </h2>
            </div>
            
            <div class="period-filter">
                <div class="period-grid">
                    <div class="form-group">
                        <label class="form-label">Data Inicial</label>
                        <input type="date" id="data-inicial" class="form-input" 
                               onchange="calcularGanhosPeriodo()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data Final</label>
                        <input type="date" id="data-final" class="form-input" 
                               onchange="calcularGanhosPeriodo()">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Filtrar por Colaborador</label>
                    <select id="filtro-periodo-colaborador" class="form-select" onchange="calcularGanhosPeriodo()">
                        <option value="TODOS">Todos os Colaboradores</option>
                    </select>
                </div>
                
                <div class="period-result" id="periodo-resultado" style="display: none;">
                    <h4 class="mb-2">Resultado do Per√≠odo</h4>
                    <div class="grid-3 gap-4 mt-4">
                        <div>
                            <span class="stats-label" style="color: rgba(255,255,255,0.8);">Total Faturado</span>
                            <div class="stats-value" id="periodo-total" style="color: white;">R$ 0,00</div>
                        </div>
                        <div>
                            <span class="stats-label" style="color: rgba(255,255,255,0.8);">Comiss√£o (8%)</span>
                            <div class="stats-value" id="periodo-comissao" style="color: white;">R$ 0,00</div>
                        </div>
                        <div>
                            <span class="stats-label" style="color: rgba(255,255,255,0.8);">Colaboradores</span>
                            <div class="stats-value" id="periodo-colaboradores" style="color: white;">0</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Se√ß√£o: Gera√ß√£o de Relat√≥rios -->
        <div class="grid-3 animate-fadeIn" id="relatorios">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-filter"></i> Filtros do Relat√≥rio
                    </h2>
                </div>
                <div class="form-group">
                    <label class="form-label">Filtrar por Cargo</label>
                    <select id="filtro-cargo" class="form-select">
                        <option value="TODOS">Todos os Cargos</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Filtrar por Colaborador</label>
                    <select id="filtro-colaborador" class="form-select">
                        <option value="TODOS">Todos os Colaboradores</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-cog"></i> Configura√ß√µes
                    </h2>
                </div>
                <div class="form-group">
                    <label class="form-label">Data do Relat√≥rio</label>
                    <input type="date" id="data-relatorio" class="form-input" onchange="salvarContextoRelatorio()">
                </div>
                <div class="form-group">
                    <label class="form-label">Observa√ß√µes</label>
                    <textarea id="observacoes-relatorio" class="form-textarea" rows="3" 
                              placeholder="Observa√ß√µes importantes..." 
                              oninput="salvarContextoRelatorio()"></textarea>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">
                        <i class="fas fa-file-pdf"></i> Gerar Relat√≥rio
                    </h2>
                </div>
                <div class="flex flex-col gap-4 h-full justify-center">
                    <button class="btn btn-success w-full" onclick="gerarEArquivarRelatorio()">
                        <i class="fas fa-file-export"></i> Gerar Relat√≥rio
                    </button>
                    <p class="text-center text-sm text-muted" id="pdf-message">
                        Clique para gerar relat√≥rio completo
                    </p>
                </div>
            </div>
        </div>

        <!-- Relat√≥rio Completo -->
        <div id="relatorio-completo-output" class="card" style="display: none;"></div>
    </div>

    <!-- Modal de Cargos -->
    <div id="cargoModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-user-tag"></i> Gerenciar Cargos
                </h3>
                <button class="modal-close" onclick="fecharModalCargos()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Adicionar Novo Cargo</label>
                    <div class="flex gap-2">
                        <input type="text" id="novo-cargo-modal-input" class="form-input" 
                               placeholder="Ex: Eletricista S√™nior">
                        <button class="btn btn-primary" onclick="adicionarNovoCargo()">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
                
                <div class="mt-6">
                    <h4 class="mb-4" style="color: var(--text-secondary); font-size: 16px;">
                        <i class="fas fa-list"></i> Cargos Existentes
                    </h4>
                    <div id="cargos-lista">
                        <!-- Lista de cargos ser√° preenchida aqui -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Hist√≥rico -->
    <div id="historicoModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-history"></i> Hist√≥rico de Relat√≥rios
                </h3>
                <button class="modal-close" onclick="fecharModalHistorico()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="historico-lista">
                    <p class="text-center text-muted">Carregando hist√≥rico...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Gerenciar Colaboradores -->
    <div id="gerenciarColaboradoresModal" class="modal-overlay">
        <div class="modal-container">
            <div class="modal-header">
                <h3 class="modal-title">
                    <i class="fas fa-users-cog"></i> Gerenciar Colaboradores
                </h3>
                <button class="modal-close" onclick="fecharModalGerenciarColaboradores()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="lista-colaboradores-gerenciar">
                    <p class="text-center text-muted">Carregando colaboradores...</p>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // --- VARI√ÅVEIS DE CONFIGURA√á√ÉO ---
        const TAXA_COMISSAO = 0.08;
        const DADOS_COLLECTION = 'relatorios-comissao';
        const DADOS_DOCUMENT = 'dados-mentor';

        // --- Vari√°veis de Estado ---
        let colaboradores = [];
        let colaboradorAtivoId = null;
        let CARGOS = ['Borracheiro', 'Alinhador', 'Mec√¢nico', 'Outro'];
        let contextoRelatorio = {};
        let db;
        let authReady = false;
        let mentorId = 'mentor-id';
        let historicoCollectionRef;
        let dadosRef;
        let updateTimeout;

        // Dados mock para inicializa√ß√£o
        const DADOS_MOCK = [
            { 
                id: 'colab-1', 
                nome: 'Douglas de Oliveira Machado', 
                cargo: 'Alinhador', 
                servicos: [
                    { servico: 'CAMBAGEM', qtd: 31, valor: 5343.00, id: 's1' }
                ], 
                dataAdicao: '2024-07-01' 
            },
            { 
                id: 'colab-2', 
                nome: 'Victor Alexandre Paes', 
                cargo: 'Borracheiro', 
                servicos: [
                    { servico: 'BALANCEAMENTO', qtd: 166, valor: 3799.90, id: 's5' }
                ], 
                dataAdicao: '2024-09-15' 
            }
        ];

        // --- Mapeamento de elementos DOM ---
        const selectorEl = document.getElementById('colaborador-selector');
        const nomeDisplayEl = document.getElementById('colaborador-nome-display');
        const cargoDisplayEl = document.getElementById('colaborador-cargo-display');
        const comissaoIndividualEl = document.getElementById('comissao-individual');
        const faturamentoIndividualEl = document.getElementById('faturamento-individual');
        const totalComissaoEl = document.getElementById('total-comissao');
        const adicionarMsgEl = document.getElementById('adicionar-msg');
        const servicosContainerEl = document.getElementById('servicos-container');
        const novoCargoSelectEl = document.getElementById('novo-cargo');
        const cargosListDisplayEl = document.getElementById('cargos-lista');
        const relatorioOutputEl = document.getElementById('relatorio-completo-output');
        const cargoModalEl = document.getElementById('cargoModal');
        const historicoModalEl = document.getElementById('historicoModal');
        const gerenciarColabModalEl = document.getElementById('gerenciarColaboradoresModal');
        const filtroCargoEl = document.getElementById('filtro-cargo');
        const filtroColaboradorEl = document.getElementById('filtro-colaborador');
        const dataRelatorioEl = document.getElementById('data-relatorio');
        const observacoesRelatorioEl = document.getElementById('observacoes-relatorio');
        const dataAdicaoInputEl = document.getElementById('data-adicao');
        const ganhoTotalHistoricoEl = document.getElementById('ganho-total-historico');
        const mediaMensalHistoricoEl = document.getElementById('media-mensal-historico');
        const dataAdicaoDisplayEl = document.getElementById('data-adicao-display');

        // Elementos do filtro por per√≠odo
        const dataInicialEl = document.getElementById('data-inicial');
        const dataFinalEl = document.getElementById('data-final');
        const filtroPeriodoColabEl = document.getElementById('filtro-periodo-colaborador');
        const periodoResultadoEl = document.getElementById('periodo-resultado');
        const periodoTotalEl = document.getElementById('periodo-total');
        const periodoComissaoEl = document.getElementById('periodo-comissao');
        const periodoColaboradoresEl = document.getElementById('periodo-colaboradores');

        // --- Firebase Imports ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot, collection, getDocs, addDoc, getDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDSe9MpVHGT7vEM7KRB2sxg-425SDpG4S4",
            authDomain: "relatorio-29dd2.firebaseapp.com",
            projectId: "relatorio-29dd2",
            storageBucket: "relatorio-29dd2.firebasestorage.app",
            messagingSenderId: "256113282650",
            appId: "1:256113282650:web:e9c55edddbd4ab26f51263",
            measurementId: "G-4WMWHDYZTN"
        };

        // Estrutura SIMPLES do Firestore
        const getDocRef = (userId) => doc(db, "mentorComissao", userId, "dados", "principal");
        const getHistoricoColRef = (userId) => collection(db, "mentorComissao", userId, "dados", "principal", "historico");

        const performAuth = async () => {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                const auth = getAuth(app);

                // Login An√¥nimo
                const userCredential = await signInAnonymously(auth);
                mentorId = userCredential.user.uid;
                authReady = true;

                console.log("‚úÖ Autentica√ß√£o Firebase An√¥nima SUCEDIDA. User ID:", mentorId);

                // Define as refer√™ncias
                dadosRef = getDocRef(mentorId);
                historicoCollectionRef = getHistoricoColRef(mentorId);

                // Verifica se j√° existe dados
                const docSnapshot = await getDoc(dadosRef);
                
                if (!docSnapshot.exists()) {
                    console.log("üìù Criando dados iniciais no Firestore...");
                    
                    const initialData = {
                        cargos: CARGOS,
                        colaboradores: DADOS_MOCK,
                        contexto: {
                            dataRelatorio: new Date().toISOString().split('T')[0],
                            observacoes: ''
                        },
                        criadoEm: new Date().toISOString()
                    };
                    
                    await setDoc(dadosRef, initialData);
                    colaboradores = DADOS_MOCK;
                    
                    // Interface inicial
                    popularCargosSelector();
                    popularFiltroCargo();
                    popularFiltroPeriodoColaborador();
                    popularSelector();
                    popularFiltroColaborador();
                    calcularRelatorioTotal();
                    
                } else {
                    // Carrega dados existentes
                    const data = docSnapshot.data();
                    if (data.cargos) CARGOS = data.cargos;
                    if (data.colaboradores) colaboradores = data.colaboradores;
                    if (data.contexto) contextoRelatorio = data.contexto;
                    
                    // Atualiza interface
                    popularCargosSelector();
                    popularFiltroCargo();
                    popularFiltroPeriodoColaborador();
                    popularSelector();
                    popularFiltroColaborador();
                    calcularRelatorioTotal();
                }

                // Configura datas padr√£o para o filtro por per√≠odo
                const hoje = new Date();
                const primeiroDiaMes = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
                const ultimoDiaMes = new Date(hoje.getFullYear(), hoje.getMonth() + 1, 0);
                
                dataInicialEl.value = primeiroDiaMes.toISOString().split('T')[0];
                dataFinalEl.value = ultimoDiaMes.toISOString().split('T')[0];
                
                if (!dataRelatorioEl.value) {
                    dataRelatorioEl.value = hoje.toISOString().split('T')[0];
                    salvarContextoRelatorio();
                }

                // Monitora altera√ß√µes em tempo real
                iniciarMonitoramentoFirestore();

            } catch (error) {
                console.error("‚ùå Erro no Firebase:", error);
                
                // Fallback para dados locais
                const errorBox = document.createElement('div');
                errorBox.className = 'alert alert-danger';
                errorBox.innerHTML = `
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>
                        <strong>Modo Offline</strong>
                        <p>Usando dados locais. Erro: ${error.message}</p>
                    </div>
                `;
                document.querySelector('.app-container').prepend(errorBox);
                
                carregarDadosMock();
            }
        };

        const carregarDadosMock = () => {
            colaboradores = DADOS_MOCK;
            CARGOS = ['Borracheiro', 'Alinhador', 'Mec√¢nico', 'Outro'];
            popularCargosSelector();
            popularFiltroCargo();
            popularFiltroPeriodoColaborador();
            popularSelector();
            popularFiltroColaborador();
            calcularRelatorioTotal();
        };

        const salvarDados = async () => {
            if (!authReady || !dadosRef) {
                console.log("‚ö†Ô∏è Firebase n√£o est√° pronto, salvando localmente");
                return;
            }
            
            try {
                const dataToSave = {
                    cargos: CARGOS,
                    colaboradores: colaboradores,
                    contexto: contextoRelatorio,
                    atualizadoEm: new Date().toISOString()
                };
                
                await setDoc(dadosRef, dataToSave, { merge: true });
                console.log("üíæ Dados salvos no Firebase");
                
            } catch (e) {
                console.error("Erro ao salvar dados no Firestore:", e);
            }
        };

        const iniciarMonitoramentoFirestore = () => {
            if (!dadosRef) return;
            
            onSnapshot(dadosRef, (docSnapshot) => {
                if (docSnapshot.exists()) {
                    const data = docSnapshot.data();

                    if (data.cargos) {
                        CARGOS = data.cargos;
                        popularCargosSelector();
                        popularFiltroCargo();
                    }
                    
                    if (data.colaboradores) {
                        colaboradores = data.colaboradores;
                        popularSelector();
                        popularFiltroColaborador();
                        popularFiltroPeriodoColaborador();
                        calcularRelatorioTotal();

                        if (colaboradorAtivoId) {
                            const colaborador = colaboradores.find(c => String(c.id) === String(colaboradorAtivoId));
                            if (colaborador) renderizarServicos(colaborador);
                        }
                    }
                    
                    if (data.contexto) {
                        contextoRelatorio = data.contexto;
                        dataRelatorioEl.value = contextoRelatorio.dataRelatorio || '';
                        observacoesRelatorioEl.value = contextoRelatorio.observacoes || '';
                    }
                    
                    // Atualiza contador de colaboradores
                    document.getElementById('total-colabs').textContent = `${colaboradores.length} ativos`;
                }
            }, (error) => {
                console.error("Erro ao monitorar Firestore:", error);
            });
        };

        // --- Fun√ß√µes de Utilidade ---
        const formatarMoeda = (valor) => {
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(valor || 0);
        };

        const formatarData = (dataISO) => {
            if (!dataISO) return 'N/D';
            return new Date(dataISO + 'T00:00:00').toLocaleDateString('pt-BR');
        };

        // --- Fun√ß√µes de Interface ---
        window.scrollToSection = (sectionId) => {
            const section = document.getElementById(sectionId);
            if (section) {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        };

        window.abrirModalCargos = () => {
            cargoModalEl.classList.add('active');
            atualizarListaCargos();
        };

        window.fecharModalCargos = () => {
            cargoModalEl.classList.remove('active');
        };

        window.abrirModalGerenciarColaboradores = () => {
            gerenciarColabModalEl.classList.add('active');
            atualizarListaColaboradoresGerenciar();
        };

        window.fecharModalGerenciarColaboradores = () => {
            gerenciarColabModalEl.classList.remove('active');
        };

        window.abrirModalHistorico = async () => {
            if (!authReady) {
                alert("‚ö†Ô∏è Conectando ao Firebase... Tente novamente em alguns segundos.");
                return;
            }
            
            historicoListaEl.innerHTML = '<p class="text-center text-muted">Carregando hist√≥rico...</p>';
            historicoModalEl.classList.add('active');

            try {
                const snapshot = await getDocs(historicoCollectionRef);

                if (snapshot.empty) {
                    historicoListaEl.innerHTML = '<p class="text-center text-muted">Nenhum relat√≥rio arquivado ainda.</p>';
                    return;
                }

                let relatorios = [];
                snapshot.forEach(doc => {
                    relatorios.push({ id: doc.id, ...doc.data() });
                });

                relatorios.sort((a, b) => new Date(b.dataGeracaoISO) - new Date(a.dataGeracaoISO));

                let html = '<div class="grid-1 gap-4">';
                relatorios.forEach(relatorio => {
                    const dataGeracao = relatorio.dataRelatorio || relatorio.dataGeracao || 'N/D';
                    const filtro = relatorio.filtroAplicado || 'Geral';
                    const totalComissao = formatarMoeda(relatorio.totalComissao);
                    const colaboradoresCount = relatorio.colaboradoresDetalhes?.length || 0;

                    html += `
                        <div class="colaborador-item" onclick="visualizarRelatorioHistorico('${relatorio.id}')" 
                             style="cursor: pointer;">
                            <div class="colaborador-info">
                                <div class="colaborador-nome">${dataGeracao}</div>
                                <div class="colaborador-details">
                                    <span>${filtro}</span>
                                    <span>‚Ä¢ ${colaboradoresCount} colabs</span>
                                </div>
                            </div>
                            <div class="colaborador-actions">
                                <span class="badge badge-success">${totalComissao}</span>
                                <button class="btn btn-sm btn-danger" 
                                        onclick="event.stopPropagation(); excluirRelatorioHistorico('${relatorio.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
                historicoListaEl.innerHTML = html;

            } catch (error) {
                console.error("Erro ao carregar hist√≥rico:", error);
                historicoListaEl.innerHTML = '<div class="alert alert-danger">Erro ao carregar o hist√≥rico.</div>';
            }
        };

        window.fecharModalHistorico = () => {
            historicoModalEl.classList.remove('active');
        };

        // Event listeners para modais
        cargoModalEl.addEventListener('click', (e) => {
            if (e.target === cargoModalEl) fecharModalCargos();
        });

        historicoModalEl.addEventListener('click', (e) => {
            if (e.target === historicoModalEl) fecharModalHistorico();
        });

        gerenciarColabModalEl.addEventListener('click', (e) => {
            if (e.target === gerenciarColabModalEl) fecharModalGerenciarColaboradores();
        });

        // --- Gest√£o de Cargos ---
        window.adicionarNovoCargo = () => {
            const novoCargoInput = document.getElementById('novo-cargo-modal-input');
            const novoCargo = novoCargoInput.value.trim();

            if (novoCargo.length < 3) {
                showAlert("‚ùå Nome do cargo deve ter pelo menos 3 caracteres.", "danger");
                return;
            }
            
            if (CARGOS.map(c => c.toLowerCase()).includes(novoCargo.toLowerCase())) {
                showAlert("‚ö†Ô∏è Este cargo j√° existe.", "warning");
                return;
            }

            CARGOS.push(novoCargo);
            salvarDados();
            popularCargosSelector();
            popularFiltroCargo();
            novoCargoInput.value = "";
            
            showAlert(`‚úÖ Cargo "${novoCargo}" adicionado com sucesso!`, "success");
            atualizarListaCargos();
        };

        window.excluirCargo = (cargoNome) => {
            if (!confirm(`‚ö†Ô∏è Tem certeza que deseja excluir o cargo "${cargoNome}"?\n\nColaboradores com este cargo ser√£o mantidos, mas o cargo n√£o estar√° mais dispon√≠vel para novos cadastros.`)) {
                return;
            }

            // Verifica se h√° colaboradores com este cargo
            const colaboradoresComCargo = colaboradores.filter(c => c.cargo === cargoNome);
            
            if (colaboradoresComCargo.length > 0) {
                if (!confirm(`‚ö†Ô∏è Existem ${colaboradoresComCargo.length} colaborador(es) com este cargo.\nEles manter√£o o cargo atual, mas voc√™ n√£o poder√° mais atribuir este cargo a novos colaboradores.\n\nDeseja continuar?`)) {
                    return;
                }
            }

            CARGOS = CARGOS.filter(c => c !== cargoNome);
            salvarDados();
            popularCargosSelector();
            popularFiltroCargo();
            
            showAlert(`‚úÖ Cargo "${cargoNome}" exclu√≠do com sucesso!`, "success");
            atualizarListaCargos();
        };

        const atualizarListaCargos = () => {
            if (cargosListDisplayEl) {
                let html = '';
                
                if (CARGOS.length === 0) {
                    html = '<p class="text-center text-muted">Nenhum cargo cadastrado</p>';
                } else {
                    CARGOS.forEach(cargo => {
                        const colaboradoresComCargo = colaboradores.filter(c => c.cargo === cargo).length;
                        
                        html += `
                            <div class="cargo-item">
                                <div>
                                    <strong>${cargo}</strong>
                                    <div class="text-sm text-muted mt-1">
                                        ${colaboradoresComCargo} colaborador(es)
                                    </div>
                                </div>
                                <button class="btn btn-sm btn-danger" onclick="excluirCargo('${cargo}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        `;
                    });
                }
                
                cargosListDisplayEl.innerHTML = html;
            }
        };

        const popularCargosSelector = () => {
            // Limpa e popula o select principal
            if (novoCargoSelectEl) {
                novoCargoSelectEl.innerHTML = '<option value="">Selecione um cargo</option>';
                CARGOS.forEach(cargo => {
                    const option = document.createElement('option');
                    option.value = cargo;
                    option.textContent = cargo;
                    novoCargoSelectEl.appendChild(option);
                });
            }

            // Atualiza filtro de cargos
            if (filtroCargoEl) {
                filtroCargoEl.innerHTML = '<option value="TODOS">Todos os Cargos</option>';
                CARGOS.forEach(cargo => {
                    const option = document.createElement('option');
                    option.value = cargo;
                    option.textContent = cargo;
                    filtroCargoEl.appendChild(option);
                });
            }
        };

        // --- Gest√£o de Colaboradores ---
        window.adicionarNovoColaborador = () => {
            const nomeInput = document.getElementById('novo-nome');
            const cargoInput = document.getElementById('novo-cargo');
            const dataAdicaoInput = document.getElementById('data-adicao');

            const nome = nomeInput.value.trim();
            const cargo = cargoInput.value;
            const dataAdicao = dataAdicaoInput.value;

            if (nome.length < 3) {
                showAlert("‚ùå O nome deve ter pelo menos 3 caracteres!", "danger");
                nomeInput.focus();
                return;
            }

            if (!dataAdicao) {
                showAlert("‚ùå A data de adi√ß√£o √© obrigat√≥ria!", "danger");
                dataAdicaoInput.focus();
                return;
            }

            if (!cargo) {
                showAlert("‚ùå Selecione um cargo!", "danger");
                cargoInput.focus();
                return;
            }

            const novoId = `colab-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;

            const novoColaborador = {
                id: novoId,
                nome: nome,
                cargo: cargo,
                servicos: [],
                dataAdicao: dataAdicao,
                criadoEm: new Date().toISOString(),
                ativo: true
            };

            colaboradores.push(novoColaborador);
            salvarDados();

            // Feedback visual
            showAlert(`‚úÖ ${nome} adicionado com sucesso!`, "success");

            // Limpa os campos
            nomeInput.value = "";
            dataAdicaoInput.value = "";
            cargoInput.value = "";

            // Foca no pr√≥ximo campo
            nomeInput.focus();

            // Atualiza lista de colaboradores
            popularFiltroPeriodoColaborador();
        };

        window.excluirColaborador = (colabId) => {
            const colaborador = colaboradores.find(c => c.id === colabId);
            if (!colaborador) return;

            if (!confirm(`‚ö†Ô∏è Tem certeza que deseja excluir permanentemente o colaborador "${colaborador.nome}"?\n\nEsta a√ß√£o n√£o pode ser desfeita e todos os dados ser√£o perdidos.`)) {
                return;
            }

            colaboradores = colaboradores.filter(c => c.id !== colabId);
            
            // Se o colaborador exclu√≠do era o ativo, seleciona outro
            if (colaboradorAtivoId === colabId) {
                colaboradorAtivoId = colaboradores.length > 0 ? colaboradores[0].id : null;
            }
            
            salvarDados();
            
            showAlert(`‚úÖ ${colaborador.nome} exclu√≠do com sucesso!`, "success");
            
            // Atualiza a interface
            popularSelector();
            popularFiltroColaborador();
            popularFiltroPeriodoColaborador();
            calcularRelatorioTotal();
            atualizarListaColaboradoresGerenciar();
        };

        const atualizarListaColaboradoresGerenciar = () => {
            const listaContainer = document.getElementById('lista-colaboradores-gerenciar');
            if (!listaContainer) return;

            if (colaboradores.length === 0) {
                listaContainer.innerHTML = '<p class="text-center text-muted">Nenhum colaborador cadastrado</p>';
                return;
            }

            let html = '<div class="grid-1 gap-3">';
            
            colaboradores.sort((a, b) => a.nome.localeCompare(b.nome)).forEach(colab => {
                const totalGanho = calcularTotalFaturadoColaborador(colab);
                const comissao = totalGanho * TAXA_COMISSAO;
                const totalServicos = colab.servicos.length;

                html += `
                    <div class="colaborador-item">
                        <div class="colaborador-info">
                            <div class="colaborador-nome">${colab.nome}</div>
                            <div class="colaborador-details">
                                <span>${colab.cargo}</span>
                                <span>‚Ä¢ ${totalServicos} servi√ßos</span>
                                <span>‚Ä¢ ${formatarMoeda(totalGanho)}</span>
                            </div>
                        </div>
                        <div class="colaborador-actions">
                            <button class="btn btn-sm btn-outline" onclick="event.stopPropagation(); editarColaborador('${colab.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="event.stopPropagation(); excluirColaborador('${colab.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            listaContainer.innerHTML = html;
        };

        window.editarColaborador = (colabId) => {
            const colaborador = colaboradores.find(c => c.id === colabId);
            if (!colaborador) return;

            const novoNome = prompt("Novo nome do colaborador:", colaborador.nome);
            if (novoNome && novoNome.trim() && novoNome !== colaborador.nome) {
                colaborador.nome = novoNome.trim();
                salvarDados();
                popularSelector();
                popularFiltroColaborador();
                popularFiltroPeriodoColaborador();
                showAlert(`‚úÖ Nome atualizado para "${novoNome}"`, "success");
            }

            const novoCargo = prompt("Novo cargo:", colaborador.cargo);
            if (novoCargo && novoCargo !== colaborador.cargo) {
                colaborador.cargo = novoCargo;
                salvarDados();
                popularSelector();
                popularFiltroColaborador();
                popularFiltroPeriodoColaborador();
                showAlert(`‚úÖ Cargo atualizado para "${novoCargo}"`, "success");
            }
        };

        const popularSelector = () => {
            if (!selectorEl) return;
            
            selectorEl.innerHTML = '<option value="">Selecione um colaborador</option>';
            
            colaboradores
                .filter(c => c.ativo !== false)
                .sort((a, b) => a.nome.localeCompare(b.nome))
                .forEach(colab => {
                    const option = document.createElement('option');
                    option.value = colab.id;
                    option.textContent = `${colab.nome} ‚Ä¢ ${colab.cargo}`;
                    selectorEl.appendChild(option);
                });

            // Seleciona o ativo ou o primeiro dispon√≠vel
            if (!colaboradorAtivoId && colaboradores.length > 0) {
                colaboradorAtivoId = colaboradores[0].id;
                if (selectorEl) selectorEl.value = colaboradorAtivoId;
                selecionarColaborador(colaboradorAtivoId);
            } else if (colaboradorAtivoId && selectorEl) {
                selectorEl.value = colaboradorAtivoId;
                selecionarColaborador(colaboradorAtivoId);
            }
        };

        const popularFiltroPeriodoColaborador = () => {
            if (!filtroPeriodoColabEl) return;
            
            filtroPeriodoColabEl.innerHTML = '<option value="TODOS">Todos os Colaboradores</option>';
            colaboradores
                .filter(c => c.ativo !== false)
                .sort((a, b) => a.nome.localeCompare(b.nome))
                .forEach(colab => {
                    const option = document.createElement('option');
                    option.value = colab.id;
                    option.textContent = `${colab.nome} (${colab.cargo})`;
                    filtroPeriodoColabEl.appendChild(option);
                });
        };

        window.selecionarColaborador = (id) => {
            colaboradorAtivoId = id;
            const colaborador = colaboradores.find(c => String(c.id) === String(colaboradorAtivoId));

            if (colaborador) {
                nomeDisplayEl.textContent = colaborador.nome;
                cargoDisplayEl.textContent = colaborador.cargo;
                dataAdicaoDisplayEl.textContent = `Contratado em: ${formatarData(colaborador.dataAdicao)}`;
                renderizarServicos(colaborador);
                
                // Anima√ß√£o de transi√ß√£o
                nomeDisplayEl.classList.add('animate-fadeIn');
                setTimeout(() => nomeDisplayEl.classList.remove('animate-fadeIn'), 500);
            } else {
                nomeDisplayEl.textContent = "-";
                cargoDisplayEl.textContent = "-";
                dataAdicaoDisplayEl.textContent = "-";
                servicosContainerEl.innerHTML = `
                    <div class="text-center p-6">
                        <i class="fas fa-user-slash icon-lg" style="color: var(--text-muted); margin-bottom: 16px;"></i>
                        <p class="text-muted">Nenhum colaborador selecionado</p>
                    </div>
                `;
            }
            
            calcularRelatorioTotal();
        };

        // --- Filtro por Per√≠odo ---
        window.calcularGanhosPeriodo = () => {
            const dataInicial = dataInicialEl.value;
            const dataFinal = dataFinalEl.value;
            const filtroColabId = filtroPeriodoColabEl.value;

            if (!dataInicial || !dataFinal) {
                periodoResultadoEl.style.display = 'none';
                return;
            }

            let colaboradoresFiltrados = colaboradores;

            // Aplica filtro por colaborador se especificado
            if (filtroColabId !== 'TODOS') {
                colaboradoresFiltrados = colaboradores.filter(c => c.id === filtroColabId);
            }

            // Aqui voc√™ implementaria a l√≥gica para filtrar servi√ßos por data
            // Por enquanto, vamos calcular o total de todos os servi√ßos
            let totalFaturado = 0;
            let totalComissao = 0;

            colaboradoresFiltrados.forEach(colab => {
                const ganho = calcularTotalFaturadoColaborador(colab);
                totalFaturado += ganho;
                totalComissao += ganho * TAXA_COMISSAO;
            });

            // Atualiza a interface
            periodoTotalEl.textContent = formatarMoeda(totalFaturado);
            periodoComissaoEl.textContent = formatarMoeda(totalComissao);
            periodoColaboradoresEl.textContent = colaboradoresFiltrados.length;
            periodoResultadoEl.style.display = 'block';

            // Adiciona informa√ß√µes sobre o per√≠odo
            const periodoInfo = document.createElement('div');
            periodoInfo.className = 'text-center text-sm mt-3';
            periodoInfo.style.color = 'rgba(255,255,255,0.8)';
            periodoInfo.textContent = `Per√≠odo: ${formatarData(dataInicial)} at√© ${formatarData(dataFinal)}`;
            
            // Remove info anterior se existir
            const infoAnterior = periodoResultadoEl.querySelector('.periodo-info');
            if (infoAnterior) infoAnterior.remove();
            
            periodoInfo.classList.add('periodo-info');
            periodoResultadoEl.appendChild(periodoInfo);
        };

        // --- Gest√£o de Servi√ßos ---
        const renderizarServicos = (colaborador) => {
            if (!colaborador.servicos || colaborador.servicos.length === 0) {
                servicosContainerEl.innerHTML = `
                    <div class="text-center p-6">
                        <i class="fas fa-clipboard-list icon-lg" style="color: var(--text-muted); margin-bottom: 16px;"></i>
                        <p class="text-muted mb-4">Nenhum servi√ßo registrado</p>
                        <button class="btn btn-primary" onclick="adicionarServico()">
                            <i class="fas fa-plus"></i> Adicionar Primeiro Servi√ßo
                        </button>
                    </div>
                `;
                return;
            }

            let html = `
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Servi√ßo</th>
                                <th>Qtd</th>
                                <th>Valor</th>
                                <th style="width: 60px;"></th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            colaborador.servicos.forEach(servico => {
                const valorUnitario = (parseFloat(servico.valor) || 0) / (parseFloat(servico.qtd) || 1);

                html += `
                    <tr data-service-id="${servico.id}">
                        <td>
                            <input type="text" value="${servico.servico}" 
                                   class="form-input" 
                                   style="background: transparent; border: none; padding: 0; font-size: 14px;"
                                   oninput="atualizarServicoDetalhes('${servico.id}', 'servico', this.value)">
                        </td>
                        <td>
                            <input type="number" value="${servico.qtd}" min="0" step="1"
                                   class="form-input" 
                                   style="width: 70px; text-align: center; padding: 8px;"
                                   oninput="atualizarServicoDetalhes('${servico.id}', 'qtd', this.value)">
                        </td>
                        <td>
                            <div class="flex-center">
                                <span style="color: var(--text-muted); margin-right: 4px; font-size: 14px;">R$</span>
                                <input type="number" value="${(parseFloat(servico.valor) || 0).toFixed(2)}" min="0" step="0.01"
                                       class="form-input" 
                                       style="width: 100px; padding: 8px; font-size: 14px;"
                                       oninput="atualizarServicoDetalhes('${servico.id}', 'valor', this.value)">
                            </div>
                        </td>
                        <td>
                            <button class="btn btn-icon btn-danger" onclick="removerServico('${servico.id}')" style="width: 40px; height: 40px;">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    </tr>
                `;
            });

            html += `
                        </tbody>
                    </table>
                </div>
            `;

            servicosContainerEl.innerHTML = html;
        };

        window.adicionarServico = () => {
            const colaborador = colaboradores.find(c => String(c.id) === String(colaboradorAtivoId));
            if (!colaborador) {
                showAlert("‚ö†Ô∏è Selecione um colaborador primeiro.", "warning");
                return;
            }

            const novoServico = {
                id: `serv-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
                servico: 'Novo Servi√ßo',
                qtd: 1,
                valor: 0.00
            };

            colaborador.servicos.push(novoServico);
            salvarDados();
            
            // Scroll para o novo servi√ßo
            setTimeout(() => {
                const newRow = document.querySelector(`[data-service-id="${novoServico.id}"]`);
                if (newRow) {
                    newRow.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    const input = newRow.querySelector('input[type="text"]');
                    if (input) {
                        input.focus();
                        input.select();
                    }
                }
            }, 100);
        };

        window.removerServico = (serviceId) => {
            if (!confirm("Tem certeza que deseja remover este servi√ßo?")) return;
            
            const colaborador = colaboradores.find(c => String(c.id) === String(colaboradorAtivoId));
            if (!colaborador) return;

            colaborador.servicos = colaborador.servicos.filter(s => String(s.id) !== String(serviceId));
            salvarDados();
            showAlert("‚úÖ Servi√ßo removido com sucesso!", "success");
        };

        window.atualizarServicoDetalhes = (serviceId, campo, valor) => {
            const colaborador = colaboradores.find(c => String(c.id) === String(colaboradorAtivoId));
            if (!colaborador) return;

            const servico = colaborador.servicos.find(s => String(s.id) === String(serviceId));
            if (!servico) return;

            servico[campo] = (campo === 'servico') ? valor : (parseFloat(valor) || 0);

            clearTimeout(updateTimeout);
            updateTimeout = setTimeout(() => {
                salvarDados();
                calcularRelatorioTotal();
            }, 800);
        };

        // --- C√°lculos ---
        const calcularTotalFaturadoColaborador = (colaborador) => {
            if (!colaborador || !colaborador.servicos) return 0;
            return colaborador.servicos.reduce((sum, s) => sum + (parseFloat(s.valor) || 0), 0);
        };

        const calcularEstatisticasHistoricas = (colaborador) => {
            const dataAdicaoISO = colaborador.dataAdicao;
            if (!dataAdicaoISO) {
                return { totalGanho: 0, mesesDesdeAdicao: 0, mediaMensal: 0 };
            }

            const totalGanho = calcularTotalFaturadoColaborador(colaborador);
            const dataInicial = new Date(dataAdicaoISO + 'T00:00:00');
            const hoje = new Date();

            let meses = (hoje.getFullYear() - dataInicial.getFullYear()) * 12;
            meses -= dataInicial.getMonth();
            meses += hoje.getMonth();

            let mesesContabilizados = Math.max(1, meses + 1);
            const mediaMensal = totalGanho / mesesContabilizados;

            return {
                totalGanho: totalGanho,
                mesesDesdeAdicao: mesesContabilizados,
                mediaMensal: mediaMensal
            };
        };

        const calcularRelatorioTotal = () => {
            let totalGanhoBruto = 0;
            let totalComissaoMentor = 0;

            colaboradores.forEach(colab => {
                if (colab.ativo !== false) {
                    const ganho = calcularTotalFaturadoColaborador(colab);
                    totalGanhoBruto += ganho;
                    totalComissaoMentor += ganho * TAXA_COMISSAO;
                }
            });

            // Atualiza o total geral
            totalComissaoEl.textContent = formatarMoeda(totalComissaoMentor);
            
            // Atualiza o contador de colaboradores
            const colabsAtivos = colaboradores.filter(c => c.ativo !== false).length;
            document.getElementById('total-colabs').textContent = `${colabsAtivos} ativos`;

            // Atualiza dados do colaborador ativo
            const colab = colaboradores.find(c => String(c.id) === String(colaboradorAtivoId));
            if (colab && colab.ativo !== false) {
                const ganho = calcularTotalFaturadoColaborador(colab);
                faturamentoIndividualEl.textContent = formatarMoeda(ganho);
                comissaoIndividualEl.textContent = formatarMoeda(ganho * TAXA_COMISSAO);

                const stats = calcularEstatisticasHistoricas(colab);
                ganhoTotalHistoricoEl.textContent = formatarMoeda(stats.totalGanho);
                mediaMensalHistoricoEl.textContent = formatarMoeda(stats.mediaMensal);
                dataAdicaoDisplayEl.textContent = `Contratado em: ${formatarData(colab.dataAdicao)}`;
            } else {
                faturamentoIndividualEl.textContent = formatarMoeda(0);
                comissaoIndividualEl.textContent = formatarMoeda(0);
                ganhoTotalHistoricoEl.textContent = formatarMoeda(0);
                mediaMensalHistoricoEl.textContent = formatarMoeda(0);
                dataAdicaoDisplayEl.textContent = "-";
            }
        };

        // --- Filtros ---
        const popularFiltroCargo = () => {
            if (!filtroCargoEl) return;
            
            filtroCargoEl.innerHTML = '<option value="TODOS">Todos os Cargos</option>';
            [...new Set(colaboradores.map(c => c.cargo))].sort().forEach(cargo => {
                const option = document.createElement('option');
                option.value = cargo;
                option.textContent = cargo;
                filtroCargoEl.appendChild(option);
            });
        };

        const popularFiltroColaborador = () => {
            if (!filtroColaboradorEl) return;
            
            filtroColaboradorEl.innerHTML = '<option value="TODOS">Todos os Colaboradores</option>';
            colaboradores
                .filter(c => c.ativo !== false)
                .sort((a, b) => a.nome.localeCompare(b.nome))
                .forEach(colab => {
                    const option = document.createElement('option');
                    option.value = colab.id;
                    option.textContent = `${colab.nome} (${colab.cargo})`;
                    filtroColaboradorEl.appendChild(option);
                });
        };

        // --- Contexto do Relat√≥rio ---
        window.salvarContextoRelatorio = () => {
            contextoRelatorio.dataRelatorio = dataRelatorioEl.value;
            contextoRelatorio.observacoes = observacoesRelatorioEl.value;
            salvarDados();
        };

        // --- Gera√ß√£o de Relat√≥rios ---
        window.gerarEArquivarRelatorio = async () => {
            if (!authReady) {
                showAlert("‚ö†Ô∏è Aguarde a conex√£o com o Firebase ser estabelecida.", "warning");
                return;
            }

            const filtroCargo = filtroCargoEl.value;
            const filtroColaboradorId = filtroColaboradorEl.value;

            // Filtragem
            let colaboradoresFiltrados = colaboradores.filter(c => c.ativo !== false);

            if (filtroColaboradorId !== 'TODOS') {
                colaboradoresFiltrados = colaboradoresFiltrados.filter(c => c.id === filtroColaboradorId);
            } else if (filtroCargo !== 'TODOS') {
                colaboradoresFiltrados = colaboradoresFiltrados.filter(c => c.cargo === filtroCargo);
            }

            if (colaboradoresFiltrados.length === 0) {
                showAlert("‚ùå Nenhum colaborador encontrado com os filtros aplicados.", "danger");
                return;
            }

            const totalComissao = colaboradoresFiltrados.reduce((total, c) => 
                total + calcularTotalFaturadoColaborador(c) * TAXA_COMISSAO, 0);

            // Prepara os dados do relat√≥rio
            const relatorioSnapshot = {
                dataGeracao: new Date().toLocaleDateString('pt-BR'),
                dataGeracaoISO: new Date().toISOString(),
                filtroAplicado: filtroColaboradorId !== 'TODOS' ? 
                    `Colaborador: ${colaboradoresFiltrados[0].nome}` :
                    (filtroCargo !== 'TODOS' ? `Cargo: ${filtroCargo}` : 'Todos (Geral)'),
                totalComissao: totalComissao,
                colaboradoresDetalhes: colaboradoresFiltrados,
                dataRelatorio: contextoRelatorio.dataRelatorio || new Date().toLocaleDateString('pt-BR'),
                observacoes: contextoRelatorio.observacoes || 'Nenhuma observa√ß√£o.'
            };

            // Arquiva no Firestore
            try {
                const addRef = await addDoc(historicoCollectionRef, relatorioSnapshot);
                
                showAlert(`‚úÖ Relat√≥rio arquivado! ID: ${addRef.id.substr(0, 8)}`, "success");
                
            } catch (e) {
                showAlert(`‚ùå Erro ao salvar: ${e.message}`, "danger");
            }

            // Gera visualiza√ß√£o
            gerarRelatorioVisual(relatorioSnapshot);
        };

        window.visualizarRelatorioHistorico = async (docId) => {
            if (!authReady) {
                showAlert("‚ö†Ô∏è Aguarde a conex√£o com o Firebase.", "warning");
                return;
            }
            
            fecharModalHistorico();

            try {
                const docRefHistorico = doc(historicoCollectionRef, docId);
                const docSnapshot = await getDoc(docRefHistorico);

                if (!docSnapshot.exists()) {
                    showAlert('‚ùå Relat√≥rio hist√≥rico n√£o encontrado.', "danger");
                    return;
                }

                const relatorio = docSnapshot.data();
                gerarRelatorioVisual(relatorio);

                // Scroll para o relat√≥rio
                setTimeout(() => {
                    relatorioOutputEl.scrollIntoView({ behavior: 'smooth' });
                }, 100);

            } catch (error) {
                console.error("Erro ao carregar relat√≥rio hist√≥rico:", error);
                showAlert("‚ùå Erro ao carregar relat√≥rio.", "danger");
            }
        };

        window.excluirRelatorioHistorico = async (docId) => {
            if (!confirm("‚ö†Ô∏è Tem certeza que deseja EXCLUIR este relat√≥rio permanentemente?")) {
                return;
            }

            try {
                const docRefHistorico = doc(historicoCollectionRef, docId);
                await deleteDoc(docRefHistorico);
                
                showAlert("‚úÖ Relat√≥rio exclu√≠do com sucesso!", "success");
                
                // Atualiza a lista
                abrirModalHistorico();
                
            } catch (error) {
                console.error("Erro ao excluir relat√≥rio:", error);
                showAlert("‚ùå Erro ao excluir relat√≥rio.", "danger");
            }
        };

        const gerarRelatorioVisual = (relatorio) => {
            const { colaboradoresDetalhes, totalComissao, dataGeracao, filtroAplicado, dataRelatorio, observacoes } = relatorio;

            let html = `
                <div class="animate-fadeIn">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-file-pdf"></i> Relat√≥rio de Comiss√£o
                        </h2>
                        <div class="flex-center gap-2">
                            <span class="badge badge-success">${dataRelatorio || dataGeracao}</span>
                            <button class="btn btn-primary btn-sm" onclick="window.print()">
                                <i class="fas fa-print"></i> Imprimir
                            </button>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <div class="grid-2 md:grid-3 gap-4">
                            <div class="stats-card">
                                <span class="stats-label">Comiss√£o Total</span>
                                <div class="stats-value">${formatarMoeda(totalComissao)}</div>
                            </div>
                            <div class="stats-card">
                                <span class="stats-label">Colaboradores</span>
                                <div class="stats-value">${colaboradoresDetalhes.length}</div>
                            </div>
                            <div class="stats-card">
                                <span class="stats-label">Filtro</span>
                                <div class="stats-value" style="font-size: 16px;">${filtroAplicado}</div>
                            </div>
                        </div>
                    </div>
                    
                    ${observacoes ? `
                        <div class="mb-6 p-4" style="background: var(--bg-secondary); border-radius: var(--radius-md);">
                            <h4 class="mb-3" style="color: var(--text-secondary); font-size: 14px;">
                                <i class="fas fa-sticky-note"></i> Observa√ß√µes
                            </h4>
                            <p style="font-size: 14px;">${observacoes}</p>
                        </div>
                    ` : ''}
            `;

            colaboradoresDetalhes.forEach((colab, index) => {
                const faturamentoIndividual = calcularTotalFaturadoColaborador(colab);
                const comissaoIndividual = faturamentoIndividual * TAXA_COMISSAO;
                const stats = calcularEstatisticasHistoricas(colab);

                html += `
                    <div class="card mb-4" style="border-left: 4px solid var(--primary);">
                        <div class="card-header">
                            <h3 class="card-title" style="font-size: 16px;">
                                <span class="badge badge-primary" style="font-size: 11px;">${index + 1}</span>
                                ${colab.nome}
                                <span class="text-sm text-muted">(${colab.cargo})</span>
                            </h3>
                            <span class="badge badge-success">${formatarMoeda(faturamentoIndividual)}</span>
                        </div>
                        
                        <div class="grid-2 gap-3 mb-4">
                            <div class="p-3" style="background: var(--bg-secondary); border-radius: var(--radius-md);">
                                <span class="stats-label" style="font-size: 12px;">Comiss√£o (8%)</span>
                                <div class="stats-value" style="font-size: 18px; color: var(--secondary);">
                                    ${formatarMoeda(comissaoIndividual)}
                                </div>
                            </div>
                            <div class="p-3" style="background: var(--bg-secondary); border-radius: var(--radius-md);">
                                <span class="stats-label" style="font-size: 12px;">Total Hist√≥rico</span>
                                <div class="stats-value" style="font-size: 18px;">
                                    ${formatarMoeda(stats.totalGanho)}
                                </div>
                            </div>
                        </div>
                        
                        ${colab.servicos.length > 0 ? `
                            <div class="table-container">
                                <table class="data-table">
                                    <thead>
                                        <tr>
                                            <th>Servi√ßo</th>
                                            <th>Qtd.</th>
                                            <th>Valor Total</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${colab.servicos.map(servico => `
                                            <tr>
                                                <td>${servico.servico}</td>
                                                <td>${servico.qtd}</td>
                                                <td>${formatarMoeda(servico.valor)}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        ` : '<p class="text-center text-muted p-4">Nenhum servi√ßo registrado</p>'}
                    </div>
                `;
            });

            html += `
                    <div class="text-center mt-6 pt-4" style="border-top: 1px solid var(--border-medium);">
                        <p class="text-muted" style="font-size: 12px;">Relat√≥rio gerado em ${new Date().toLocaleString('pt-BR')}</p>
                    </div>
                </div>
            `;

            relatorioOutputEl.innerHTML = html;
            relatorioOutputEl.style.display = 'block';
            
            // Anima√ß√£o de entrada
            relatorioOutputEl.classList.add('animate-fadeIn');
        };

        // --- Fun√ß√µes de Utilidade ---
        const showAlert = (message, type = 'info') => {
            // Remove alertas anteriores
            const existingAlerts = document.querySelectorAll('.alert-temporary');
            existingAlerts.forEach(alert => alert.remove());

            const alert = document.createElement('div');
            alert.className = `alert alert-${type} alert-temporary animate-fadeIn`;
            alert.style.position = 'fixed';
            alert.style.top = '20px';
            alert.style.right = '20px';
            alert.style.left = '20px';
            alert.style.zIndex = '9999';
            alert.style.maxWidth = '400px';
            alert.style.margin = '0 auto';
            alert.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'danger' ? 'exclamation-circle' : 'info-circle'}"></i>
                <div style="flex: 1; font-size: 14px;">${message}</div>
                <button onclick="this.parentElement.remove()" style="background: none; border: none; color: inherit; cursor: pointer;">
                    <i class="fas fa-times"></i>
                </button>
            `;

            document.body.appendChild(alert);

            // Remove automaticamente ap√≥s 5 segundos
            setTimeout(() => {
                if (alert.parentElement) {
                    alert.style.transition = 'opacity 0.5s';
                    alert.style.opacity = '0';
                    setTimeout(() => alert.remove(), 500);
                }
            }, 5000);
        };

        // --- Inicializa√ß√£o ---
        window.addEventListener('DOMContentLoaded', () => {
            performAuth();
            
            // Configura data padr√£o para o relat√≥rio
            if (!dataRelatorioEl.value) {
                const hoje = new Date();
                dataRelatorioEl.value = hoje.toISOString().split('T')[0];
            }
        });

        // Configura datas padr√£o para o filtro por per√≠odo
        const hoje = new Date();
        const primeiroDiaMes = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
        const ultimoDiaMes = new Date(hoje.getFullYear(), hoje.getMonth() + 1, 0);
        
        if (dataInicialEl && !dataInicialEl.value) {
            dataInicialEl.value = primeiroDiaMes.toISOString().split('T')[0];
        }
        
        if (dataFinalEl && !dataFinalEl.value) {
            dataFinalEl.value = ultimoDiaMes.toISOString().split('T')[0];
        }

        // Adiciona listener para calcular per√≠odo quando as datas mudarem
        if (dataInicialEl && dataFinalEl) {
            dataInicialEl.addEventListener('change', calcularGanhosPeriodo);
            dataFinalEl.addEventListener('change', calcularGanhosPeriodo);
            filtroPeriodoColabEl.addEventListener('change', calcularGanhosPeriodo);
        }

        // Exporta fun√ß√µes para o escopo global
        window.adicionarNovoCargo = adicionarNovoCargo;
        window.excluirCargo = excluirCargo;
        window.abrirModalCargos = abrirModalCargos;
        window.fecharModalCargos = fecharModalCargos;
        window.abrirModalGerenciarColaboradores = abrirModalGerenciarColaboradores;
        window.fecharModalGerenciarColaboradores = fecharModalGerenciarColaboradores;
        window.excluirColaborador = excluirColaborador;
        window.editarColaborador = editarColaborador;
        window.adicionarNovoColaborador = adicionarNovoColaborador;
        window.adicionarServico = adicionarServico;
        window.removerServico = removerServico;
        window.atualizarServicoDetalhes = atualizarServicoDetalhes;
        window.gerarEArquivarRelatorio = gerarEArquivarRelatorio;
        window.abrirModalHistorico = abrirModalHistorico;
        window.fecharModalHistorico = fecharModalHistorico;
        window.visualizarRelatorioHistorico = visualizarRelatorioHistorico;
        window.excluirRelatorioHistorico = excluirRelatorioHistorico;
        window.salvarContextoRelatorio = salvarContextoRelatorio;
        window.selecionarColaborador = selecionarColaborador;
        window.scrollToSection = scrollToSection;
        window.calcularGanhosPeriodo = calcularGanhosPeriodo;
    </script>
</body>
</html>